# @time: 2022/1/13 6:28 PM
# Author: pan
# @File: 01jsonæ¨¡å—.py
# @Software: PyCharm
"""
1ã€ä»€ä¹ˆæ˜¯åºåˆ—åŒ–&ååºåˆ—åŒ–ï¼Ÿ
å†…å­˜ä¸­çš„æ•°æ® ----> åºåˆ—åŒ–    ------> ç‰¹å®šçš„æ ¼å¼(jsonæˆ–pickleæ ¼å¼)
å†…å­˜ä¸­çš„æ•°æ® <---- ååºåˆ—åŒ–  <------ ç‰¹å®šçš„æ ¼å¼(jsonæˆ–pickleæ ¼å¼)

2ã€ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–ï¼Ÿ
åºåˆ—åŒ–å°±æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®è½¬æ¢ä¸€ç§ç‰¹å®šæ ¼å¼ï¼Œè¿™ç§æ ¼å¼çš„æ•°æ®å¯¹äºå­˜å‚¨æˆ–ä¼ è¾“éƒ½æ¯”è¾ƒå‹å¥½
åºåˆ—åŒ–åçš„æ•°æ®å¯ä»¥æœ‰ä¸¤ç§ç”¨é€”
I ç”¨æˆ·æ•°æ®å­˜å‚¨ï¼ˆæ•°æ®å­˜æ¡£ç­‰ï¼‰
II ç”¨æˆ·å¤šå¹³å°ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼ˆè·¨å¹³å°æ•°æ®äº¤äº’ï¼‰

å¼ºè°ƒï¼š
ç”¨é€”1ä½¿ç”¨çš„ç‰¹å®šæ ¼å¼ï¼šå¯ä»¥æ˜¯ä¸€ç§ä¸“é—¨çš„æ ¼å¼ = pickleåªæœ‰pythonå¯ä»¥è¯†åˆ«
ç”¨é€”2ä½¿ç”¨çš„ç‰¹å®šæ ¼å¼ï¼šéœ€è¦æ˜¯å¤šç§å¹³å°éƒ½å¯ä»¥è¯†åˆ«å‡ºæ¥çš„æ ¼å¼ = jsonæ ¼å¼çš„æ•°æ®

3ã€å¦‚ä½•è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–
ä½¿ç”¨åº“jsonæˆ–pickle

"""

# jsonä½¿ç”¨
import json

# å®ä¾‹1

# åºåˆ—åŒ–
# json_res = json.dumps([1, 'aaa', 'bbb', True, False, 10.1])
# print(json_res, type(json_res))
# [1, "aaa", "bbb", true, false, 10.1] <class 'str'>
# åºåˆ—åŒ–åçš„æ•°æ®æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²
# int/float => int/float
# list => []
# dic => {}
# str => "" åºåˆ—åŒ–åæ˜¯ä¸€ä¸ªåŒå¼•å·æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²
# True/False => true/false  å¤§å†™çš„çœŸå‡åºåˆ—åŒ–åå˜æˆå°å†™çš„true/false


# ååºåˆ—åŒ–
# res = json.loads(json_res)
# print(res, type(res))
# [1, 'aaa', 'bbb', True, False, 10.1] <class 'list'>
# ååºåˆ—åŒ–å è½¬æ¢ä¸º pythonè¯­è¨€å¯ä»¥è¯†åˆ«çš„æ ¼å¼


# å®ä¾‹ å°†åºåˆ—åŒ–åçš„æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶ä¸­
# ä»¥åŠä»æ–‡ä»¶ä¸­ å–å‡ºæ•°æ®è¿›è¡Œååºåˆ—åŒ–
print('å®ä¾‹2'.center(100, "="))


# ======== åºåˆ—åŒ–æ•°æ®åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ ==========
json_res = json.dumps([1, 'aaa', 'bbb', True, False, 10.1, "ä½ å¥½ä¸­å›½"])
print(json_res, type(json_res))
# ä¸­æ–‡ä¼šè½¬æ¢ä¸ºunicodeç 
# [1, "aaa", "bbb", true, false, 10.1, "\u4f60\u597d\u4e2d\u56fd"] <class 'str'>
with open(r'test.json', mode='wt', encoding='utf-8') as f:
    f.write(json_res)
    # å¯ä»¥ç›´æ¥ä½¿ç”¨dumpæ–¹æ³• ç®€åŒ–è¯¥åºåˆ—åŒ–
    # dumpä¸­ä¼šé»˜è®¤å°†åºåˆ—åŒ–åçš„æ•°æ®è¿›è¡Œå†™å…¥åˆ°æ–‡ä»¶ä¸­
    # json.dump([1, 'aaa', 'bbb', True, False, 10.1], f)


# ========== ååºåˆ—åŒ–æ–‡ä»¶ä¸­çš„æ•°æ® ==============
with open(r'test.json', mode='rt', encoding='utf-8') as f:
    res = json.loads(f.read())
    print(res, type(res))
    # å¯ä»¥ä½¿ç”¨loadç®€åŒ–ååºåˆ—åŒ–çš„ç»“æ„
    # loadä¼šé»˜è®¤å…ˆè¿›è¡Œè¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹ ç„¶åè¿›è¡Œååºåˆ—åŒ–
    # json.load(f)


# å…¶ä»–å®ä¾‹
# TypeError: Object of type set is not JSON serializable
# jsonåºåˆ—åŒ– ä¸æ”¯æŒé›†åˆç±»å‹çš„æ•°æ®
# json.dumps({1, 2, 3, 10})

# å¯¹äºä¸€ä¸ªå…ƒç»„è¿›è¡Œåºåˆ—åŒ– ä¼šè¢«åºåˆ—åŒ–æˆä¸€ä¸ªåˆ—è¡¨å½¢å¼çš„å­—ç¬¦ä¸²
# [1, 2, 3, 10] <class 'str'>
# res = json.dumps((1, 2, 3, 10))
# print(res, type(res))

# jsonåºåˆ—åŒ–å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²
# pythonçš„å­—ç¬¦ä¸²åºåˆ—åŒ–å ä¼šè½¬æ¢ä¸ºåŒå¼•å·çš„æ•°æ®  è€Œä¸æ˜¯å•å¼•å·çš„æ•°æ®
res = json.loads('[1, "aaa", "bbb", "ä½ å¥½ä¸­å›½ğŸ‡¨ğŸ‡³"]')
print(res, type(res))

# ä¸æ”¯æŒè¿™ç§jsonæ ¼å¼çš„æ•°æ®
# jsonå­—ç¬¦ä¸²ä¸­ä¸èƒ½å‡ºç°å•å¼•å·
# res2 = json.loads("[1, 'aaa', True]")
# print(res, type(res2))

"""
éœ€æ±‚ï¼š
ä¸€ä¸ªé¡¹ç›®ä¸­å¼€å‘å®Œæ¯•åï¼Œæƒ³è¦ä¿®æ”¹jsonåºåˆ—åŒ–çš„æ–¹æ³•
ä½†æ˜¯é¡¹ç›®ä¸­å¾ˆå¤šåœ°æ–¹éƒ½ä½¿ç”¨äº† dumpså’Œloads 
ä¸€ä¸ªä¸€ä¸ªçš„ä¿®æ”¹å¤ªéº»çƒ¦ å¦‚ä½•åŠå‘¢ï¼Ÿ

å¯ä»¥ä½¿ç”¨çŒ´å­è¡¥ä¸è¿›è¡Œä¿®æ”¹ï¼ï¼ï¼
åªéœ€è¦åœ¨é¡¹ç›®çš„èµ·å§‹æ–‡ä»¶startä¸­è¿›è¡Œä¿®æ”¹ä¸€ä¸‹ ä¹Ÿå°±æ˜¯æ‰“è¡¥ä¸

import json
# import ujson

def monkey_patch_json():
    json.__name__ = "ujson"
    # json.dumps = ujson.dumps
    # json.loads = ujson.loads

# åœ¨é¡¹ç›®çš„å¯åŠ¨æ–‡ä»¶ä¸­è¿›è¡Œè°ƒç”¨è¯¥å‡½æ•°
monkey_patch_json()

# ä¸èƒ½ä½¿ç”¨è¯¥ç§æ–¹å¼
# å¦‚æœä½¿ç”¨æ”¹ç§æ–¹å¼ ä¹Ÿä¸è¦åœ¨å¾ˆå¤šåœ°æ–¹éƒ½è¿›è¡Œè®¾ç½®
# ä½†æ˜¯å¤šæ¬¡å¯¼å…¥ä¸€ä¸ªåº“ åªä¼šå¼•ç”¨ç¬¬ä¸€æ¬¡å¯¼å…¥çš„æ—¶å€™äº§ç”Ÿçš„åç§°ç©ºé—´
import ujson as json
"""

# pickle æ¨¡å—
# è¯¥æ¨¡å—å’Œjsonç±»ä¼¼
# pickleæ¨¡å—æ”¯æŒæ‰€æœ‰çš„pythonæ•°æ®æ ¼å¼
# ä¸é€‚åˆè¿›è¡Œè·¨å¹³å°æ•°æ®ä¼ è¾“  å› ä¸º å…¶ä»–å¹³å°æœ‰å¯èƒ½æ²¡æœ‰pythonçš„æ•°æ®ç±»å‹
import pickle

# res = pickle.dumps([1, "aaa", "bbb", True, False, 10.111])
# pickleæ”¯æŒé›†åˆç±»å‹ jsonä¸æ”¯æŒé›†åˆç±»å‹
res = pickle.dumps({1, 10, 22, 100})
# è¿”å›çš„æ˜¯bytesç±»å‹
# b'\x80\x04\x95\x1e\x00\x00\x00\x00\x00\x00\x00]\x94(K\x01\x8c\x03aaa\x94\x8c\x03bbb\x94\x88\x89G@$8\xd4\xfd\xf3\xb6Fe.' <class 'bytes'>
print(res, type(res))

r = pickle.loads(res)
print(r, type(r))







